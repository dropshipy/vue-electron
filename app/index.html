<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Shopee Power Tools</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script
      crossorigin="anonymous"
      src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"
    ></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../.env.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100;0,9..40,200;0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;0,9..40,800;0,9..40,900;0,9..40,1000;1,9..40,100;1,9..40,200;1,9..40,300;1,9..40,400;1,9..40,500;1,9..40,600;1,9..40,700;1,9..40,800;1,9..40,900;1,9..40,1000&family=Nunito+Sans:opsz,wght@6..12,200&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
  </head>
  <style>
    body {
      font-family: "DM Sans", sans-serif;
    }
  </style>
  <body class="bg-[#EEEDFA]">
    <div id="app" class="w-full" @click="handleCloseSetting">
      <template v-if="userInfo ">
        <nav
          class="w-full flex justify-between items-center px-8 bg-white h-[70px] border"
          style="box-shadow: 0px 2px 20px 0px rgba(67, 56, 201, 0.1)"
        >
          <img
            src="./assets/brand/spt.png"
            alt="shopee power tools"
            class="w-[125px] h-auto"
          />

          <div class="flex gap-10 items-center">
            <div class="relative">
              <section
                class="flex cursor-pointer"
                id="menu-button"
                @click="isOpenSetting = !isOpenSetting"
              >
                <div class="flex items-center gap-2">
                  <img
                    src="./assets/icons/setting.svg"
                    alt="setting"
                    class="w-5 h-5 ease-in-out transition-all"
                    :class="{'rotate-90' : isOpenSetting}"
                  />
                  <p>Setting</p>
                </div>
              </section>
              <div
                class="transition-all ease-in-out absolute top-[200%] right-[80%] bg-white w-max shadow rounded-lg text-[#66738F]"
              >
                <section
                  :class="[isOpenSetting ? 'h-max py-5' : 'h-0']"
                  class="overflow-hidden ease-in transition-all space-y-3 px-5"
                >
                  <div
                    class="flex gap-2 cursor-pointer hover:text-black"
                    @click="isShowModalAccountSubscription = true"
                  >
                    <img
                      src="./assets/icons/profile.svg"
                      alt="account"
                      class="w-5 h-5"
                    />

                    <p class="text-sm whitespace-nowrap leading-normal">
                      Akun SPT
                    </p>
                  </div>
                  <div
                    class="flex gap-2 cursor-pointer hover:text-black"
                    @click="isShowModalDelete = true"
                  >
                    <img
                      src="./assets/icons/delete.svg"
                      alt="account"
                      class="w-5 h-5"
                    />
                    <p class="text-sm whitespace-nowrap leading-normal">
                      Hapus Sesi Login Shopee
                    </p>
                  </div>
                </section>
              </div>
            </div>
            <button
              @click="logout"
              class="text-base font-bold bg-[#f3694a] text-white h-9 px-4 rounded-lg hover:opacity-80"
            >
              Logout
            </button>
          </div>
        </nav>
        <main>
          <section class="w-full">
            <div class="mx-auto w-full max-w-[370px] mt-10">
              <h1
                class="text-center text-2xl font-semibold text-transparent bg-clip-text bg-gradient-to-r from-[#f3694a] to-[#f79e44]"
              >
                Konfigurasi Shopee Power Tools
              </h1>
              <div class="mt-10 space-y-4">
                <a href="./html/auto-unfollow.html">
                  <div
                    class="bg-[#f3694a] h-10 flex items-center justify-center rounded text-white font-medium hover:scale-y-110 transition-all ease-in hover:opacity-90"
                  >
                    <button>Auto unfollow</button>
                  </div>
                </a>
                <a href="./html/crawl-creator.html" class="block">
                  <div
                    class="bg-[#f3694a] h-10 flex items-center justify-center rounded text-white font-medium hover:scale-y-110 transition-all ease-in hover:opacity-90"
                  >
                    <button>Auto Chat Creator</button>
                  </div>
                </a>
                <a href="./html/reply-reviews.html" class="block">
                  <div
                    class="bg-[#f3694a] h-10 flex items-center justify-center rounded text-white font-medium hover:scale-y-110 transition-all ease-in hover:opacity-90"
                  >
                    <button>Balas Ulasan Otomatis</button>
                  </div>
                </a>
              </div>
              <a href="./html/database-creator.html">Test Module</a>
            </div>
          </section>
        </main>
      </template>
      <template v-else> Kamu Belum Login </template>

      <!-- modal component -->
      <div
        v-if="isShowModalDelete"
        class="fixed z-50 bg-black/40 top-0 left-0 right-0 bottom-0"
      >
        <div
          class="bg-white fixed top-40 left-1/2 -translate-x-1/2 p-5 rounded-lg w-[400px]"
        >
          <h1 class="text-base text-black font-medium">
            Hapus Sesi Login Shopee
          </h1>
          <p class="text-sm text-[#656565] pt-2">
            Apakah kamu ingin menghapus info sesi login pada akun shopee kamu?
          </p>
          <div class="text-sm flex justify-end gap-2 mt-7">
            <button
              @click="isShowModalDelete = !isShowModalDelete"
              class="bg-white text-[#f3694a] h-8 w-[80px] border-[#f3694a] rounded border hover:opacity-80"
            >
              Batal
            </button>
            <button
              @click="deleteCookies"
              class="bg-[#f3694a] text-white h-8 w-[80px] rounded border hover:opacity-80 border-[#f3694a]"
            >
              Hapus
            </button>
          </div>
        </div>
      </div>
      <div
        class="fixed top-0 left-0 right-0 bottom-0 bg-black/40"
        v-if="isShowModalAccountSubscription"
      >
        <div
          class="space-y-4 bg-white rounded-lg p-5 w-max relative top-40 left-1/2 -translate-x-1/2 min-w-[400px]"
        >
          <img
            src="./assets/icons/close.svg"
            alt="close"
            class="w-6 h-6 absolute left-[102%] top-1 cursor-pointer"
            @click="isShowModalAccountSubscription = !isShowModalAccountSubscription"
          />
          <h1>Akun Shopee Power Tools</h1>
          <section>
            <label
              for="emailSubscription"
              class="block text-sm text-[#66738F] pb-1"
              >Email</label
            >
            <input
              v-model="emailSubscription"
              id="emailSubscription"
              type="email"
              placeholder="Masukkan email kamu disini"
              class="border focus:outline-none py-2 px-3 w-full rounded text-sm text-[#66738F]"
            />
          </section>
          <section>
            <label
              for="passwordSubscription"
              class="block text-sm text-[#66738F] pb-1"
              >Password</label
            >
            <div class="relative">
              <img
                :src="[isShowPasswordSubscription ?'./assets/icons/eye-show.svg':'./assets/icons/eye-hide.svg' ]"
                alt="togle password"
                class="w-6 h-6 absolute top-1/2 -translate-y-1/2 right-2 cursor-pointer"
                @click="isShowPasswordSubscription = !isShowPasswordSubscription"
              />
              <input
                :type="[isShowPasswordSubscription? 'text':'password']"
                id="passwordSubscription"
                v-model="passwordSubscription"
                placeholder="Masukkan password kamu disini"
                class="border focus:outline-none py-2 px-3 w-full rounded text-sm text-[#66738F]"
              />
            </div>
          </section>
          <section>
            <label for="subscription" class="block text-sm text-[#66738F] pb-1"
              >Subscription Code</label
            >
            <input
              v-model="subscriptionCode"
              id="subscription"
              type="text"
              placeholder="Masukkan subscription code kamu disini"
              class="border focus:outline-none py-2 px-3 w-full rounded text-sm text-[#66738F]"
            />
          </section>
          <div class="mt-5 text-right">
            <button
              @click="saveAccountSubscription"
              class="text-sm font-medium bg-[#f3694a] text-white py-2 px-4 rounded-lg hover:opacity-80"
            >
              Simpan
            </button>
          </div>
        </div>
      </div>
    </div>
    <script>
      new Vue({
        el: "#app",
        data: {
          baseUrl: window.env.VUE_APP_BASE_URL,
          userInfo: null,
          cookies: null,
          isOpenSetting: false,
          isShowModalDelete: false,
          isShowModalAccountSubscription: false,
          isShowPasswordSubscription: false,
          emailSubscription: null,
          passwordSubscription: null,
          subscriptionCode: null,
        },
        mounted() {
          const getUserInfo = localStorage.getItem("user_info");
          this.userInfo = JSON.parse(getUserInfo);
          if (!this.userInfo) {
            window.location.href = "./html/login-page.html";
          }
          this.getAccountSubscription();
        },
        methods: {
          deleteCookies() {
            window.electron.ipcRenderer.send("delete-cookies-bot");
          },
          logout() {
            localStorage.removeItem("user_info");
            window.electron.ipcRenderer.send("delete-cookies-shopee-tools");
            window.location.href = "./html/login-page.html";
          },
          saveAccountSubscription() {
            const {
              emailSubscription,
              passwordSubscription,
              subscriptionCode,
            } = this;
            if (
              !emailSubscription ||
              !passwordSubscription ||
              !subscriptionCode
            ) {
              alert("Form tidak lengkap");
            } else {
              const accountShopeeTools = {
                email: emailSubscription,
                password: passwordSubscription,
                subscription: subscriptionCode,
              };
              window.electron.ipcRenderer.send(
                "account-subscription",
                accountShopeeTools
              );
            }
          },
          getAccountSubscription() {
            const xhr = new XMLHttpRequest();
            xhr.onreadystatechange = () => {
              if (xhr.readyState === 4 && xhr.status === 200) {
                const data = JSON.parse(xhr.responseText);
                this.emailSubscription = data.email;
                this.passwordSubscription = data.password;
                this.subscriptionCode = data.subscription;
              }
            };

            xhr.open("GET", "./store/account-subscription.json", true);
            xhr.send();
          },
          handleCloseSetting(event) {
            const menuButton = document.getElementById("menu-button");
            if (!menuButton.contains(event.target)) {
              this.isOpenSetting = false;
            }
          },
        },
      });
    </script>
  </body>
</html>
